---
created: 2023-09-20T13:52:45.774Z
updated: 2024-07-12T16:23:23.671Z
assigned: ""
progress: 0
tags:
  - App
---

# Parcels / Mailbox

- Requires: All default homebrew repos must be public. If a user wants to store some non-character content privately, they must make a new module. Homebrew must be public so friends can send parcels to characters.
- Users have "friends" aka an address book, of other github accounts. Users add friends via a new page, using a search bar. Searching for a user's account by name, adding the name to their address book if the account exists in github. Friends which have a homebrew repo (must be public) can be accessed, but is not synced to via the autosync.
- Characters have settings which contain a list of party members. This list can be added to by picking a character on a friend's public homebrew repo.
- Characters in a private repo do not show the parcel/mailbox button. If the character is public, it has a parcel/mailbox button to open the mailbox menu.
- Users can select one or more items from their character inventory to send via parcel. This can be accessed via the context actions in the item pane for a single item (or sending a specific quantity of an item). It can also be accessed by selecting one or more items in the inventory panel. Sending one or more items via parcel opens the parcel/mailbox menu. This prompts the user to select a party member to send the items to. Confirming the parcel brings the user to the mailbox root menu where they can see their outgoing parcel, what character+user it was sent to, and what items were in it.
- Parcel Sending Tech Notes: When the parcel is confirmed, the items (or quantities if partial) are removed from the inventory, and a "outgoing parcel" datum is added to the sendering character. The outgoing parcel contains the items that were sent and a link to a Pull Request. A pull request is opened on the receiving player's homebrew repo (which is why it must be public). The PR / Issue title has a specific format identifying that it is a parcel autogenerated from app, and its body is a specificaly serialized format containing the items and the character+user that it was sent from.
- Parcel Actions after sending:
  - Receiver can accept the parcel, closing the issue as accepted and adding the items to the receiving character's inventory.
  - Receiver can reject the parcel, closing the issue as rejected.
  - Sender can cancel the parcel, which rejects the PR and returns the item to their inventory. This fails if the PR was already accepted.
  - Sender can claim a rejected parcel, removing the parcel datum from their character and returning the rejected items to their inventory. (this is why the items are both in the PR and the outgoing parcel datum)
  - Sender can acknowledge an accepted parcel, removing the parcel datum from their character.
- When a character initially loads, it fetches all incoming parcels on the user's homebrew which pertain to the character being opened. When fetching is complete, each incoming parcel is added to the serialized mailbox as an incoming datum (it has the character+user that sent it, and a link to the PR, along with any extra data).
- The mailbox menu shows a list of all active parcels, both incoming and outgoing. Each parcel can be selected to view its contents.
- Users can click a "check for parcels" button in their mailbox, which disables itself and shows a spinner while an async tasks queries all open PRs on the user's homebrew and returns a list of PRs which are parcels for that character (reruns the "check for parcels on initial load" async task). When the request is returned, the button enables itself and displays either "no new parcels found" or "found X new parcels". When it is clicked, it returns to the initial state (to check for parcels).
